package com.tga.api.access;

import java.util.ArrayList;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.codehaus.jettison.json.JSONArray;
import org.codehaus.jettison.json.JSONException;

import com.tga.api.algorithm.OnlineDetection;
import com.tga.api.base.BaseService;


@Path("/app")
public class AppService extends BaseService {
	private static final Log LOGGER = LogFactory.getLog("InfoLog");
	
	@GET
	@Path("/detection/calculation")
	@Produces(MediaType.APPLICATION_JSON)
	public Response getOnlineDetectionCalculation() throws JSONException 
	{
		//augmented current atr
		String augmentedCurStr = "15359,40857,40858,1425,1426,1427,1428,1429,34423,34443,34444,34445,34699,34700,34701,34702,34703,34704,34705,1571,1572,1573,1574,1575,1576,1577,1578,2463,2464,2465,42953,3504,3505,3506,3507,3508,3509,3510,2962,2963,2966,18162,18165,18166,18137,18138,18139,18140,18141,18142,18143,18144,18145,18146,18147,35624,16826,16827,16828,16829,16830,16831,16832,16833,16834,16835";
		ArrayList<Long> augmented_cur_atr = OnlineDetection.getIdList(augmentedCurStr);
		//gps point assigned atr
		String assignedStr = "40857,1427,1427,1428,34443,34699,34702,34703,1574,1575,1577,2463,2464,3504,3506,3506,3507,3510,18162,18139,18143,18147,16826,16831,16835";
		ArrayList<Long> assigned_cur_atr = OnlineDetection.getIdList(assignedStr);
		
		//recommend atrs
		ArrayList<ArrayList<Long>> rec_atrs = new ArrayList<ArrayList<Long>>();
		//#1: 15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2960,2961,3511,2962,2963,2966,18162,18165,18166,18137,18138,18139,18140,18141,18142,18143,18144,18145,18146,18147,35624,16826,16827,16828,16829,16830,16831,16832,16833,16834,16835
		String str1 = "15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2960,2961,3511,2962,2963,2966,18162,18165,18166,18137,18138,18139,18140,18141,18142,18143,18144,18145,18146,18147,35624,16826,16827,16828,16829,16830,16831,16832,16833,16834,16835";
		ArrayList<Long> rec_1 = OnlineDetection.getIdList(str1);
		
		//#2: 34430,15339,40200,15346,35517,35518,10469,10468,17705,17704,24607,1197,1191,1192,1193,17865,34722,17864,37928,37929,2745,2746,2747,2748,2749,2750,2751,2752,2753,2754,2756,29795,29796,29797,18145,18146,18147,35624,16826,16827,16828,16829,16830,16831,16832,16833,16834,16835
		String str2 = "34430,15339,40200,15346,35517,35518,10469,10468,17705,17704,24607,1197,1191,1192,1193,17865,34722,17864,37928,37929,2745,2746,2747,2748,2749,2750,2751,2752,2753,2754,2756,29795,29796,29797,18145,18146,18147,35624,16826,16827,16828,16829,16830,16831,16832,16833,16834,16835";
		ArrayList<Long> rec_2 = OnlineDetection.getIdList(str2);
		
		//#3: 15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2960,2961,3511,2962,2963,2966,18162,18165,18166,18137,18138,18139,18140,18141,18142,18143,18144,29798,29799,29800,29801,29802,29803,16814,16815,16816,16817,16818,16835
		String str3 = "15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2960,2961,3511,2962,2963,2966,18162,18165,18166,18137,18138,18139,18140,18141,18142,18143,18144,29798,29799,29800,29801,29802,29803,16814,16815,16816,16817,16818,16835";
		ArrayList<Long> rec_3 = OnlineDetection.getIdList(str3);
		
		//#4: 15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2985,2986,2968,18046,18047,18048,18045,18034,18035,18036,18037,18038,18039,18040,18041,18041,18042,18043,18044,3094,3150,3151,3108,3153,3123,3124,35704,35692,35693,35694,35695,35696,35697,16837,16836,16835
		String str4 = "15359,40857,40858,1425,1426,1427,1428,1429,34423,34424,34425,34426,34435,34427,34428,34429,2977,2978,2979,2981,2982,2983,2984,2985,2986,2968,18046,18047,18048,18045,18034,18035,18036,18037,18038,18039,18040,18041,18041,18042,18043,18044,3094,3150,3151,3108,3153,3123,3124,35704,35692,35693,35694,35695,35696,35697,16837,16836,16835";
		ArrayList<Long> rec_4 = OnlineDetection.getIdList(str4);
		
		//#5: 34430,15339,40200,15346,2947,2948,1201,3209,324,325,326,29778,29779,29780,27824,3542,27832,27833,27834,27835,3172,3167,3163,3157,18024,18038,18039,18040,18041,18041,18042,18043,18044,3094,3150,3151,3108,3153,3123,3124,35704,35692,35693,35694,35695,35696,35697,16837,16836,16835
		String str5 = "34430,15339,40200,15346,2947,2948,1201,3209,324,325,326,29778,29779,29780,27824,3542,27832,27833,27834,27835,3172,3167,3163,3157,18024,18038,18039,18040,18041,18041,18042,18043,18044,3094,3150,3151,3108,3153,3123,3124,35704,35692,35693,35694,35695,35696,35697,16837,16836,16835";
		ArrayList<Long> rec_5 = OnlineDetection.getIdList(str5);
		
		rec_atrs.add(rec_1);
		rec_atrs.add(rec_2);
		rec_atrs.add(rec_3);
		rec_atrs.add(rec_4);
		rec_atrs.add(rec_5);
		
		JSONArray result = OnlineDetection.calcuateAnamolyScore(assigned_cur_atr, augmented_cur_atr, rec_atrs);
		
		return buildResponse(OK, result);
	}
}